# 汎用シフト可能日計算アプリ

Google Calendarと連携して、個人の予定に基づいた最適なシフト可能日を自動計算するWebアプリケーションです。

## 機能概要

### 🔧 主要機能
- **Google Calendar連携**: OAuth認証によるリアルタイムカレンダーデータ取得
- **柔軟なシフト計算**: 営業時間、最低勤務時間、移動時間を考慮した高精度計算
- **インテリジェントな予定処理**: 時間指定予定と終日予定の自動区別
- **複数月対応**: 期間をまたいだシフト計算とカレンダー表生成
- **出力機能**: 印刷最適化されたシフト表とCSVエクスポート

### ⚙️ 設定オプション
- 営業時間の指定（開始・終了時刻）
- 最低勤務時間・最大勤務時間
- 移動時間（予定前後のバッファ時間）
- 除外曜日の設定
- 祝日の自動除外
- 分割シフトの許可設定

## セットアップ手順

### 1. 必要な環境
- Python 3.8以上
- インターネット接続（Google Calendar API利用のため）

### 2. 依存関係のインストール
```bash
pip install -r requirements.txt
```

### 3. Google OAuth認証設定
1. [Google Cloud Console](https://console.cloud.google.com/)でプロジェクトを作成
2. Google Calendar APIを有効化
3. OAuth 2.0クライアントIDを作成
4. リダイレクトURIに `http://localhost:5000/auth/google/callback` を追加
5. `.env`ファイルに認証情報を設定：

```env
GOOGLE_CLIENT_ID=your_google_client_id_here
GOOGLE_CLIENT_SECRET=your_google_client_secret_here
GOOGLE_REDIRECT_URI=http://localhost:5000/auth/google/callback
```

### 4. アプリケーションの起動
```bash
python app.py
```

ブラウザで `http://localhost:5000/app` にアクセスしてください。

## 使用方法

### 基本的な使用手順

1. **Googleアカウント認証**
   - 「Googleアカウント認証」ボタンをクリック
   - Googleアカウントでログインしてカレンダーアクセスを許可

2. **勤務条件の設定**
   - 営業時間（勤務可能時間帯）を設定
   - 最低勤務時間と移動時間を入力
   - 必要に応じて除外曜日を選択

3. **期間・カレンダー設定**
   - 開始日と終了日を指定
   - 使用するカレンダーIDを設定（通常は「primary」）

4. **シフト計算実行**
   - 「シフト可能日を計算」ボタンをクリック
   - 結果が自動で表示されます

5. **結果の確認・選択**
   - 各日付の勤務可能状況を確認
   - チェックボックスで出勤希望日を選択
   - 予定詳細はマウスホバーで確認可能

6. **シフト表の出力**
   - 「シフト表を生成」で印刷用カレンダー形式の表を作成
   - 「CSV出力」でデータファイルとしてエクスポート

### 高度な機能

#### イベント詳細ツールチップ
- シフト結果にマウスを重ねると、その日の予定詳細が表示されます
- 時間指定の予定と終日の予定が区別して表示されます

#### 設定の保存・読込
- 「設定を保存」で現在の設定をブラウザに保存
- 「設定を読込」で保存した設定を復元

#### 複数月シフト表
- 計算期間が複数月にわたる場合、各月ごとに独立したカレンダーを生成
- 印刷時に月ごとに改ページされます

## ファイル構成

```
シフト計算アプリ/
├── app.py                 # Flaskメインアプリケーション
├── requirements.txt       # Python依存関係
├── .env                   # 環境変数（認証情報）
├── .gitignore            # Git除外設定
├── README.md             # このファイル
├── static/
│   └── shift_scheduler_app.html  # フロントエンドHTML
└── instance/
    └── tokens.db         # ユーザー認証トークンDB（自動生成）
```

## 技術仕様

### バックエンド
- **フレームワーク**: Flask
- **データベース**: SQLite（トークン管理）
- **認証**: Google OAuth 2.0
- **API**: Google Calendar API v3

### フロントエンド
- **HTML5 + CSS3**: レスポンシブデザイン
- **JavaScript**: 非同期通信とUI制御
- **スタイリング**: カスタムCSS（Gradient背景、アニメーション）

## トラブルシューティング

### 認証エラー
- Google Cloud ConsoleでリダイレクトURIが正しく設定されているか確認
- `.env`ファイルの認証情報が正確か確認

### カレンダー取得エラー
- インターネット接続を確認
- Google Calendar APIが有効化されているか確認

### シフト計算結果が表示されない
- 設定した期間内に予定が存在するか確認
- 営業時間の設定が適切か確認

## ライセンス

このプロジェクトはMITライセンスの下で公開されています。

## 開発者向け情報

### カスタマイズポイント
- `static/shift_scheduler_app.html`でUI・UXをカスタマイズ可能
- `app.py`でAPI処理やビジネスロジックを拡張可能
- 祝日API（holidays-jp.github.io）を他の地域に変更可能

### 拡張可能な機能
- 複数人でのシフト調整機能
- シフトパターンの自動提案
- メール通知機能
- カレンダーへのシフト書き込み機能

---

**作成日**: 2025年
**バージョン**: 1.0.0